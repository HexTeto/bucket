# MongoDB Day 7

<br>
<br>

## 特殊的索引和集合

#### Capped Collection

MongoDB 中的集合通常都是动态创建的, 而且尺寸也是随着数据增多而动态扩展的.
但很多时候也需要能够严格限制容量的集合,
在 MongoDB 中称这类集合为 "capped collection".

固定集合特殊的地方主要在于:
- 固定集合的实现类似于一个环状队列,
向一个已满地固定集合中插入数据则最早存在的数据将会被删除以释放空间.
- 在固定集合中, 数据被顺序写入磁盘上的固定空间,
因此它们在 "spinning disk" 上的写入速度非常快,
尤其当该集合拥有专用的磁盘时.
- 固定集合必须被显式创建, 而不能随着数据操作动态创建.

```js
// 创建一个大小为 100000 字节, 最多允许 100 个文档的固定集合
db.createCollection("cap_col", {"capped": true, "size": 100000, "max": 100})
```

可以用 `convertToCapped()` 将非固定集合转换为固定集合, 但是固定集合无法转为其它集合.
修改固定集合唯一的方法就是删除之后重建.

#### Natural Sort

由于固定集合中数据都是被顺序写入磁盘的固定空间的, 于是固定集合就存在一种 "自然排序",
即按照磁盘顺序的排序, 也就是按文档被插入的先后顺序进行排序, 可以是正向或反向.

```js
db.cap_col.find().sort({'$natural': 1})
db.cap_col.find().sort({'$natural': -1})
```
